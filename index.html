<!-- THIS FILE IS CONNECTED TO: https://docs.google.com/spreadsheets/d/16FFnJVQ2yAoMYyiaHz-6jjAVnDTjiOoZC5FjvaOkG8w/edit?usp=drive_link -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAGIBIG</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	
    <!-- jQuery CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
	
	
    <style>
		/* Style the pagination controls */
		.dataTables_wrapper .dataTables_paginate .paginate_button {
			  padding: 8px 16px;
			  margin: 0 4px;
			  border: 1px solid #ddd;
			  background-color: #f9f9f9;
			  color: #333;
			  cursor: pointer;
			  border-radius: 4px;
			  transition: background-color 0.3s, color 0.3s;
			}

			.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
			  background-color: #e0e0e0;
			  color: #000;
			}

		/* Style the search input */
		.dataTables_wrapper .dataTables_filter input {
			  padding: 6px 12px;
			  margin-left: 8px;
			  border: 1px solid #ddd;
			  border-radius: 4px;
			  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			  font-size: 14px;
			}
		/* Style the table header */
		.dataTables_wrapper .dataTables_scrollHead th {
			  background-color: #333;
			  color: white;
			  text-align: center;
			  padding: 12px;
			  border-bottom: 2px solid #444;
			}

		/* Style the table rows */
		.dataTables_wrapper .dataTables_scrollBody tr:nth-child(even) {
			  background-color: #f9f9f9;
			}

			.dataTables_wrapper .dataTables_scrollBody tr:hover {
			  background-color: #f1f1f1;
			  transition: background-color 0.3s;
			}
		.content {
          flex: 1; /* Pushes the footer down */
        }
        footer {
          background-color: #f8d7da; /* Light red background */
          text-align: center;
          padding: 10px;
          color: #333;
        }

        /* Fade-in animation */
        @keyframes fadeInFooter {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .fade-in-footer {
          animation: fadeInFooter 1.5s ease-out;
        }
 
    </style>
</head>
<body>

	<div class="container mt-4">
	
	<div class="col-md" style="text-align: center;">
    <!-- Image at the top -->
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRzY71S96ZGtabHtS5LyC5Df_aGdfBKLuAxkQ&s" 
         alt="Top Image" width="75">
    
    <h4 class="mb-4">S E C R E T A R I A T</h4>
	</div>
		
	
	
		<div class="container mt-4">
		<h5 class="mb-1">Search for Members...</h5>
			<div class="row g-3 mb-2">
	
				<div class="col-md">
					<div class="form-floating">
						<select id="pGroup" class="form-select" name="pGroup" onchange="postPGroup(this.value)" required>
							<!-- Add pGroup options here -->
						</select>
						<label for="pGroup">Prayer Group</label>
					</div>
				</div>

		
		
				<div class="col-md">
					<div class="form-floating">
						<select id="pgQuery1" class="form-select" name="pgQuery1" required>
							<option value="" disabled selected>-- Search by: --</option>
							<option value="MEMBER STATUS">STATUS</option>
							<option value="BIRTH MONTH">BIRTH MONTH</option>
							<option value="ANNIVERSARY">ANNIVERSARY</option>
							<option value="SPIRITUAL JOURNEY">SPIRITUAL JOURNEY</option>
							
						</select>
						<label for="pgQuery1">View List by:</label>
					</div>
				</div>
				
				
				<div class="col-md">
					<div class="form-floating">
						<select id="pgQuery2" class="form-select" name="pgQuery2" required>
							<option value="" disabled selected>-- Then Search by: --</option>
							
						</select>
						<label for="pgQuery2">Filter List by:</label>
					</div>
				</div>
				
				<div class="col-md" id="pgQuery3Container" style="display: none;" >
					<div class="form-floating">
						<select id="pgQuery3" class="form-select" name="pgQuery3" >
							<option value="" disabled selected>-- Select Options: --</option>
						
						</select>
						<label for="pgQuery3">More Filter Options:</label>
					</div>
				</div>
							
			</div>
			
			<div class="row g-3 mb-2">
				<div class="col-md d-flex justify-content-end">
					
			  <button type="button" class="btn btn-primary" id="btnGo" onclick="generateQuery()">Get List</button>
              <button type="button" class="btn btn-secondary" id="saveAsPDF" onclick="saveAsPDF()" style="display: none;">Save as PDF</button>

					
				</div>
			</div>
			
		</div>

		<br> <!-- Adds a line break between the form and the div -->
          
		  <div class="col-md">
			
			<table id="dataTable" class="display" >
				<thead>
				  <tr id="tableHeaders">
					<!-- Headers will be generated dynamically -->
				  </tr>
				</thead>
				<tbody id="tableBody">
				  <!-- Data will be generated dynamically -->
				</tbody>
			 </table>
         
          </div>
		
		
		<br> <!-- Adds a line break between the form and the div -->
	
</div>

	<br> <!-- Adds a line break between the form and the div -->
  <br> <!-- Adds a line break between the form and the div -->

<footer class="fade-in-footer">
  <div class="container">

    

    <a href="https://sites.google.com/view/pdcc-online/home" target="_blank" title="Visit Pag-ibig Online">PAG-IBIG SA DIYOS CATHOLIC COMMUNITY</a>

    <span style="margin: 0 10px;">|</span>

	<a href="#" target="_blank" id="pgFile" style="visibility: hidden;">PRAYER GROUP ONLINE FILE</a>
             
    

    

    <!--
        <span style="margin: 0 10px;">|</span>


        <a href="https://your-link-here.com" target="_blank">DONATE TO DKPG</a>

        <span style="margin: 0 10px;">|</span>

        <a href="https://your-link-here.com" target="_blank">DONATE TO PAG-IBIG</a>

    -->

  </div>

   <br> <!-- Adds a line break between the form and the div -->
  <h5 class="mb-2">
     <a href="https://www.facebook.com/messages/e2ee/t/26375574608708533" target="_blank" title="Message Tito Ferdz" style="text-decoration: none; color: inherit;">
    ALL FOR GOD'S GLORY!</a>
  </h5>

<!--  
   <br> <!-- Adds a line break between the form and the div 

    <p class="mb-1">
      Webpage design by 
      <a href="https://www.facebook.com/DKOnlineBuddy" target="_blank" 
        title="Visit Tito Ferdz's page"
        style="text-decoration: underline; color: #007bff;">
        Tito Ferdz
      </a>
    </p>

    
      <p class="mb-3">
        Help him maintain and continue this website development.<br>
        <small>
          Scan QR to Donate:
          <a href="https://drive.google.com/file/d/1vIScj5mpEaDUPLP7VPwK7IMxJaF-3ViT/view?usp=share_link" target="_blank" style="text-decoration: underline; color: #007bff;">PAYMAYA</a> /
          <a href="https://drive.google.com/file/d/1e6mHD40qaExySh_TzUjVy6v7fAYh2Z30/view?usp=share_link" target="_blank" style="text-decoration: underline; color: #007bff;">GCASH</a>
        </small>
      </p>
-->
  


</footer>


	<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script>

	const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbybbqJtol4Mfq_G45fLwdR_y6fqSa-TG0uGxEVzRVejDLB_HwgW8vqacJYj_Ldh_epE3g/exec";

	
	// Event listener for pgQuery1 changes
			document.getElementById("pgQuery1").addEventListener("change", () => {
				updatePgQuery2(); // If needed, call your existing function
				togglePgQuery3(); // Update pgQuery3 options & visibility
				
				
			});    
			
			function updatePgQuery2() {
			const pgQuery1Value = document.getElementById("pgQuery1").value;
			const pgQuery2 = document.getElementById("pgQuery2");

			// Clear previous options
			pgQuery2.innerHTML = '<option value="" disabled selected>-- Select Options: --</option>';

				// Check pgQuery1 value and update pgQuery2 options
				if (["COUPLE NAME", "BIRTH MONTH", "ANNIVERSARY", "MEMBER STATUS", "HOUSEHOLD", "SPIRITUAL JOURNEY"].includes(pgQuery1Value)) { // Include HOUSEHOLD here
					if (pgQuery1Value === "SPIRITUAL JOURNEY") {
						["MEW", "LSS", "GSS", "ICW", "LCR", "ESS", "LFS", "SFS", "FEW"].forEach(option => {
							pgQuery2.innerHTML += `<option value="${option}">${option}</option>`;
						});
					} else if (pgQuery1Value === "BIRTH MONTH" || pgQuery1Value === "ANNIVERSARY") {
						["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST",
						 "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"].forEach(option => {
							pgQuery2.innerHTML += `<option value="${option}">${option}</option>`;
						});
					} else if (pgQuery1Value === "MEMBER STATUS") {
						[
							"MEMBER", "WORKER"
						].forEach(option => {
							pgQuery2.innerHTML += `<option value="${option}">${option}</option>`;
						});
					
					} 
				}
			}
	
	
			// Function to toggle pgQuery3 visibility based on pgQuery2 selection
					  function togglePgQuery3() {
						const pgQuery1Value = document.getElementById("pgQuery1").value;
						const pgQuery3Container = document.getElementById("pgQuery3Container");
						const pgQuery3 = document.getElementById("pgQuery3");

						// Clear previous options
						pgQuery3.innerHTML = '<option value="" disabled selected>-- Select Options: --</option>';

						// Check pgQuery1 value and update pgQuery3 options & visibility
						if (["SPIRITUAL JOURNEY", "BIRTH MONTH"].includes(pgQuery1Value)) {
							pgQuery3Container.style.display = "block"; // Show pgQuery3
							
							if (pgQuery1Value === "SPIRITUAL JOURNEY") {
								pgQuery3.innerHTML += '<option value="0">CANDIDATES</option>';
								pgQuery3.innerHTML += '<option value="1">GRADUATES</option>';
							} else if (pgQuery1Value === "BIRTH MONTH") {
								pgQuery3.innerHTML += '<option value="HUSBAND">HUSBAND</option>';
								pgQuery3.innerHTML += '<option value="WIFE">WIFE</option>';
							}
						} else {
							pgQuery3Container.style.display = "none"; // Hide pgQuery3
						}
					}
	
	
	// Fetch prayer group names to populate the dropdown and datalist on page load
		window.onload = function () {
		  const dropdownEndpoint = `${WEBAPP_URL}?action=getDropdownOptions`;// Replace with pgList list Web App URL
		 
		  // Fetch data for Dropdown
		  fetch(dropdownEndpoint)
			.then((response) => response.json())
			.then((dropdownData) => {
			  const dropdown = document.getElementById('pGroup');
			  dropdown.innerHTML = '<option value="" disabled selected>-- Select Prayer Group Name --</option>'; // Clear previous options and add placeholder

			  dropdownData.forEach((item) => {
				const option = document.createElement('option');
				option.value = item.pgName; // Use trade name for value
				option.text = item.pgName; // Display trade name
				dropdown.appendChild(option);
			  });
			})
			.catch((error) => console.error('Error fetching dropdown data:', error));
		}
		
	//
		
		          // Function to generate the query formula
        function generateQuery() {
            const pgQuery1Value = document.getElementById("pgQuery1").value;
            const pgQuery2Value = document.getElementById("pgQuery2").value;
            const pgQuery3Value = document.getElementById("pgQuery3").value;
            
            let queryFormula = '';
			
			if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "MEW" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT N, C, D, E, H, I WHERE N is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "MEW" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT N, C, D, E, H, I WHERE N is not null", 1)`;
			
			} else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LSS" && pgQuery3Value === "0") { // O has a value (not empty)
				queryFormula = `=QUERY(DATA!A:Z, "SELECT O, C, D, E, H, I WHERE O is null", 1)`;
			} else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LSS" && pgQuery3Value === "1") {	// O is empty
				queryFormula = `=QUERY(DATA!A:Z, "SELECT O, C, D, E, H, I WHERE O is not null", 1)`;
			
			} else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "GSS" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT P, C, D, E, H, I WHERE P is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "GSS" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT P, C, D, E, H, I WHERE P is not null", 1)`;

            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "ICW" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT Q, C, D, E, H, I WHERE Q is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "ICW" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT Q, C, D, E, H, I WHERE Q is not null", 1)`;
            
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LCR" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT R, C, D, E, H, I WHERE R is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LCR" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT R, C, D, E, H, I WHERE R is not null", 1)`;
            
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "ESS" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT S, C, D, E, H, I WHERE S is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "ESS" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT S, C, D, E, H, I WHERE S is not null", 1)`;

            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LFS" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT T, C, D, E, H, I WHERE T is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "LFS" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT T, C, D, E, H, I WHERE T is not null", 1)`;
            
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "SFS" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT U, C, D, E, H, I WHERE U is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "SFS" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT U, C, D, E, H, I WHERE U is not null", 1)`;
			
			} else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "FEW" && pgQuery3Value === "0") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT U, C, D, E, H, I WHERE V is null", 1)`;
            } else if (pgQuery1Value === "SPIRITUAL JOURNEY" && pgQuery2Value === "FEW" && pgQuery3Value === "1") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT U, C, D, E, H, I WHERE V is not null", 1)`;
                 
            } else if (pgQuery1Value === "MEMBER STATUS" && pgQuery2Value === "MEMBER") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, H, I WHERE W = 'MEMBER'", 1)`;
			} else if (pgQuery1Value === "MEMBER STATUS" && pgQuery2Value === "WORKER") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, H, I WHERE W = 'WORKER'", 1)`;
            
            
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JANUARY"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 0", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "FEBRUARY"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 1", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "MARCH"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 2", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "APRIL"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 3", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "MAY"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 4", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JUNE"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 5", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JULY"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 6", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "AUGUST"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 7", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "SEPTEMBER"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 8", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "OCTOBER"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 9", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "NOVEMBER"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 10", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "DECEMBER"&& pgQuery3Value === "HUSBAND") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, E, F, G WHERE MONTH(G) = 11", 1)`;
            
            
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JANUARY"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 0", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "FEBRUARY"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 1", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "MARCH"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 2", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "APRIL"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 3", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "MAY"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 4", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JUNE"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 5", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "JULY"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 6", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "AUGUST"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 7", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "SEPTEMBER"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 8", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "OCTOBER"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 9", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "NOVEMBER"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 10", 1)`;
            } else if (pgQuery1Value === "BIRTH MONTH" && pgQuery2Value === "DECEMBER"&& pgQuery3Value === "WIFE") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, H, I, J, K WHERE MONTH(K) = 11", 1)`;
            
            } else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "JANUARY"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 0", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "FEBRUARY"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 1", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "MARCH"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 2", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "APRIL"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 3", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "MAY"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 4", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "JUNE"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 5", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "JULY"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 6", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "AUGUST"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 7", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "SEPTEMBER"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 8", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "OCTOBER"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 9", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "NOVEMBER"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 10", 1)`;
            }  else if (pgQuery1Value === "ANNIVERSARY" && pgQuery2Value === "DECEMBER"&& pgQuery3Value === "") {
                queryFormula = `=QUERY(DATA!A:Z, "SELECT C, D, H, M WHERE MONTH(M) = 11", 1)`;
            
            }   

            updateSpreadsheet(queryFormula);
			fetchDataAndInitializeTable();
			fetchDataAndInitializeTable();
						
        }
		
				
			function postPGroup(value) {
		  const pgFileElement = document.getElementById('pgFile');
		  
		  // Hide the element and clear the href
		  pgFileElement.style.visibility = "hidden";
		  pgFileElement.href = "";

		  // Make the POST request
		  fetch(WEBAPP_URL, {
			method: 'POST',
			headers: {
			  'Content-Type': 'application/x-www-form-urlencoded'
			},
			body: new URLSearchParams({
			  'pGroup': value
			})
		  })
		  .then(response => response.text())
		  .then(data => {
			console.log('Spreadsheet updated:', data);
			
			// Fetch the updated URL and update the element only once
			fetchPGurl();
		  })
		  .catch(error => {
			console.error('Error:', error);
		  });
		}

		function fetchPGurl() {
		  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbybbqJtol4Mfq_G45fLwdR_y6fqSa-TG0uGxEVzRVejDLB_HwgW8vqacJYj_Ldh_epE3g/exec";
		  
		  fetch(`${WEBAPP_URL}?action=fetchSheetURL`)
			.then(response => response.text())  // Expecting plain text response
			.then(data => {
			  const pgFileElement = document.getElementById('pgFile');
			  if (data.trim()) { // Ensure data is not empty
				pgFileElement.href = data;
				pgFileElement.style.visibility = "visible"; // Show the element after setting the href
			  } else {
				console.error("Received empty URL");
			  }
			})
			.catch(error => console.error('Error fetching URL:', error));
		}


    function updateSpreadsheet(queryFormula) {
        
		fetch(WEBAPP_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                'queryFormula': queryFormula
            })
        })
        .then(response => response.text())
        .then(data => {
            console.log('Spreadsheet updated:', data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
		
		//
		
function fetchDataAndInitializeTable() {
  fetch('https://script.google.com/macros/s/AKfycbybbqJtol4Mfq_G45fLwdR_y6fqSa-TG0uGxEVzRVejDLB_HwgW8vqacJYj_Ldh_epE3g/exec?action=fetchTableData')
    .then(response => {
      console.log('Response received:', response); // Log the response object
      return response.json();
    })
    .then(json => {
      console.log('JSON received:', json); // Log the received JSON data
      const data = json.data;
      console.log('Fetched data:', data); // Log fetched data
	  
	 // Clear existing DataTable instance if it exists
      if ($.fn.DataTable.isDataTable('#dataTable')) {
        $('#dataTable').DataTable().clear().destroy();
      }

      // Clear existing table headers and body
      document.getElementById('tableHeaders').innerHTML = '';
      document.getElementById('tableBody').innerHTML = '';
	 
	 if (Array.isArray(data) && data.length > 0) {
        const columns = Object.keys(data[0]);
        console.log('Columns:', columns); // Log columns
        
        // Set table headers
        const headers = columns.map(key => `<th>${key}</th>`).join('');
        document.getElementById('tableHeaders').innerHTML = headers;
        console.log('Headers set:', headers); // Log headers

        // Set table body
        const rows = data.map(row => {
          const cells = columns.map(col => {
            if (['H_BDAY', 'W_BDAY', 'ANNIVERSARY'].includes(col) && row[col]) {
              const date = new Date(row[col]);

		// Adjust for local timezone offset
		const localOffset = date.getTimezoneOffset() * 60000;
		const localDate = new Date(date.getTime() - localOffset);
		
		// Extract date components manually
		const day = String(localDate.getDate()).padStart(2, '0'); // Ensure two-digit day
		const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		const month = monthNames[localDate.getMonth()]; // Get short month name
		const year = String(localDate.getFullYear()).slice(-2); // Extract last two digits of year
		
		const formattedDate = `${day}-${month}-${year}`; // Correct format
		
		return `<td>${formattedDate}</td>`;


	  }
		  
            return `<td>${row[col]}</td>`;
          }).join('');
          return `<tr>${cells}</tr>`;
        }).join('');
        document.getElementById('tableBody').innerHTML = rows;
        console.log('Rows set:', rows); // Log rows

        // Initialize DataTable
        $('#dataTable').DataTable();
      } else {
        console.error('Invalid data format or no data available:', data);
      }
    })
    .catch(error => console.error('Error fetching data:', error));
}

	
</script>



	
	
</body>
</html>

